# 按键设置命令列表

该部分命令涉及按键功能绑定（鼠标按键映射成不同的功能）。

只有一个命令，但是主要的是这个命令的参数如何代表一个按键功能。

## get_button_function

| 读命令 | 写命令 | 读取参数长度 | 数据参数长度 |
| ------ | ------ | ------------ | ------------ |
| 0x028c | 0x020c | 1(profile)+1(button)+1(hypershift) | 7           |

读取或设置按键的功能。

读取参数有3个，均为1字节：

- `profile`: profile 编号
- `button`: 鼠标按键编号，具体见下方的表
- `hypershift`: 设置或读取的是否为 hypershift 下的功能，0 为普通，1 为 hypershift 开启

| 鼠标按键编号 | 对应按键 |
| ------ | ------ |
| 0x01 | 左键 |
| 0x02 | 右键 |
| 0x03 | 中键 |
| 0x04 | 后侧键 |
| 0x05 | 前侧键 |
| 0x09 | 滚轮上滚 |
| 0x0a | 滚轮下滚 |
| 0x0e | 底部椭圆按键 |
| 0x0f | 侧边瞄准键 |
| 0x34 | 滚轮左拨 |
| 0x35 | 滚轮右拨 |
| 0x60 | 滚轮下方偏下的键 |
| 0x6a | 滚轮下方偏上的键 |

数据参数代表按下硬件按钮以后触发的软件功能，具体编码如下：

- 1字节 功能类别
- 1字节 功能数据的长度
- 最多5字节 功能数据

其中，功能类别都有：

(宏 = 巨集，以下统称「宏」)

| 功能类别编号 | 名称 |
| ------ | ------ |
| 0x00 | 禁用（按下没有任何功能） |
| 0x01 | 鼠标类 |
| 0x0b | 鼠标双击 |
| 0x0e | 鼠标连击 |
| 0x02 | 键盘类 |
| 0x0d | 键盘连击 |
| 0x09 | 系统电源控制 |
| 0x0a | Consumer（包括媒体按键）|
| 0x03 | 宏（固定次数） |
| 0x04 | 宏（按下触发） |
| 0x05 | 宏（切换） |
| 0x0f | 宏（序列） |
| 0x06 | DPI 切换 |
| 0x07 | Profile 切换 |
| 0x0c | Hypershift 切换 |
| 0x12 | 滚轮模式切换 |

以下分别解释每一个功能类别，其功能数据的编码含义

### 禁用

该类别没有功能数据，可以直接将长度设置为 0

### 鼠标类、鼠标双击

鼠标类就是按下按钮以后发送鼠标事件，比如左键右键等。双击的话，在按下的时候会连续发送两次按下事件。

鼠标类和鼠标双击两个类的数据的格式相同，都只有一个字节：

- 1字节 按键值

按键值和软件按键的对应关系如下表：

| 按键值 | 对应鼠标按键 |
| ------ | ------ |
| 0x01 | 鼠标左键 |
| 0x02 | 鼠标右键 |
| 0x03 | 鼠标中键 |
| 0x04 | 侧键后退键 |
| 0x05 | 侧键前进键 |
| 0x09 | 滚轮向上滚动 |
| 0x0a | 滚轮向下滚动 |
| 0x68 | 滚轮向左拨动 |
| 0x69 | 滚轮向右拨动 |

### 鼠标连击

鼠标连击的类就是在按下按键的时候，会按照设定好的频率不断发送鼠标按键按下的事件。数据格式是：

- 1字节 按键值，见上表
- 2字节 间隔时间

间隔时间占2字节，是大端无符号整数，单位是毫秒，意思就是在硬件按钮按下时，每 x 毫秒发送一次按键按下的事件。值越小的话，发送得越快。

### 键盘类

键盘类会在按键按下以后发送键盘事件，例如 a / b / F12 / Ctrl+C，相当于把鼠标按键绑定成键盘按键（也可以设置成组合键）。

数据格式是：

- 1字节 组合键值
- 1字节 按键值

其中，组合键值包括左右 (Ctrl, Shift, Alt, GUI(Windows 键))，可以和某一个按键自由组合，组合键值的8位每一位代表一个按键，可以把多个位置为1，置为1代表按下该键，为0代表不按下。

| 组合键值 | 对应按键 |
| ------ | ------ |
| 0x01 | 左 Ctrl |
| 0x02 | 左 Shift |
| 0x04 | 左 Alt |
| 0x08 | 左 GUI |
| 0x10 | 右 Ctrl |
| 0x20 | 右 Shift |
| 0x40 | 右 Alt |
| 0x80 | 右 GUI |

按键值是1个字节，表示的按键就是键盘按键的 HID 编码。例如 A 是 0x04，可以参考该表里面的 Keyboard/Keypad Page：

<https://usb.org/sites/default/files/hut1_5.pdf>

### 键盘连击

这个和鼠标连击原理类似，但是是换成了发送键盘按键。数据格式是：

- 1字节 组合键值
- 1字节 按键值
- 2字节 间隔时间

### 系统电源控制

这个类型包括三个功能，Power Down, Sleep, Wake Up。这三个功能就是 HID 的 Generic Desktop Page 里面 Usage ID 为 0x81~0x83 的，由鼠标的 interface 1, id 3 发出。一般用不到这个功能，按了以后，在我的 Windows 系统相当于按电源按钮。

数据格式是：

- 1字节 按键值

| 按键值 | 对应功能 |
| ------ | ------ |
| 0x01 | Power Down |
| 0x02 | Sleep |
| 0x04 | Wake Up |

### Consumer（包括媒体按键）

发送 Consumer Page (USB Usage page 0x0C) 的任意 Usage ID 的事件。例如一般键盘上的媒体键就包括在里面，如增加音量和减少音量分别是 0x00e9 和 0x00ea

数据格式是：

- 2字节 按键值

这个按键值就是 Consumer Page 的 Usage ID，可以参考该表里面的 Consumer Page：

<https://usb.org/sites/default/files/hut1_5.pdf>

### 宏（固定次数）

按键以后，触发鼠标内部保存的某个宏固定的次数。

数据格式是：

- 2字节 宏 ID
- 1字节 重复次数

雷蛇鼠标板载内存上可以保存多个宏，每个宏都有一个2字节的 ID，这里只是把按键功能指向那个 ID 的宏，宏的内容是啥，不归这个命令管。如果没有那个 ID 的宏的话，应该按键就不触发，相当于禁用了。

### 宏（按下触发）

按键按下的时候，对应 ID 的宏就一直循环触发，松开以后就停止触发。

数据格式是：

- 2字节 宏 ID

### 宏（切换）

按键按下一次，对应 ID 的宏就一直循环触发，再按一次，就停止触发。

数据格式是：

- 2字节 宏 ID

### 宏（序列）

按键每按一次，对应 ID 的宏就触发两个操作，再按一次就触发接下来的两个操作。到最后的时候会循环到最初。鼠标会存储当前执行到哪个操作。

这个就是雷蛇软件里面宏可以设置为「序列」类型，序列就是有很多操作，每按一次，依次执行下一个操作。它的内部实现其实是每个键有按下、松开两个操作，然后宏存储的时候就是把各个按键的按下、松开操作连续存储进去，然后绑定按键的时候绑定成这个「宏（序列）」的功能类。

数据格式是：

- 2字节 宏 ID

### DPI 切换

这个类是用来切换 DPI 的，雷蛇默认把滚轮下面比较靠下的那个键绑定成 DPI 切换键，除了循环切换 DPI 以外，还有几个其他功能。

第一种数据格式是：

- 1字节 操作

操作可以是：

| 按键值 | 对应功能 |
| ------ | ------ |
| 0x01 | 切换到 DPI 等级列表的下一项 |
| 0x02 | 切换到 DPI 等级列表的上一项 |
| 0x06 | 切换到下一项，但是到末尾时循环到开始 |
| 0x07 | 切换到上一项，但是到最前方时循环到最后 |

雷蛇默认的循环切换 DPI 的操作就是 0x06

第二种数据格式是：

- 1字节 0x03
- 1字节 序号

这个格式的功能是切换到某个固定的 DPI 等级，从1开始的，例如 0x03 0x01 就是切换到第一个等级。

第三种数据格式是：

- 1字节 0x05
- 4字节 DPI 数值

这个格式是相当于雷蛇的瞄准键，按下按键以后临时切换成某个 DPI，松开以后恢复原状的。DPI 数值是 2 个字节是 X，2 个字节是 Y，和基本命令里面的 DPI 数值是相同的。

### Profile 切换

这个类是切换板载的 Profile（配置方案）的。默认雷蛇底下的按键就是这个功能。

第一种数据格式是：

- 1字节 操作

操作可以是：

| 按键值 | 对应功能 |
| ------ | ------ |
| 0x01 | 切换到下一个 Profile |
| 0x02 | 切换到上一个 Profile |
| 0x04 | 切换到下一个 Profile，但是到末尾时循环到开始 |
| 0x05 | 切换到上一个 Profile，但是到最前方时循环到最后 |

第二种数据格式是：

- 1字节 0x03
- 1字节 Profile 编号

功能是切换到某个固定的 Profile。

Profile 编号，白/红/绿/蓝/青，编号分别为 1~5。

### Hypershift 切换

Hypershift 切换按键，按住以后就是 Hypershift 模式，数据只有一个固定的字节，是 0x01，不清楚含义

### 滚轮模式切换

滚轮模式切换按键，按下以后，滚轮会切换 tactile 和 freespin 模式，数据只有一个固定的字节，是 0x01，不清楚含义

## 例子

因为这个命令比较复杂，这里举出几个例子

将白色 profile 中滚轮左拨（非 hypershift）绑定为复制，右拨绑定为粘贴：

01 34 00 02 02 01 06 00 00 00

01 35 00 02 02 01 19 00 00 00

将hypershift的左键绑定成右键

01 01 01 01 01 02 00 00 00 00

临时绑定(direct profile)，滚轮左拨连续触发滚轮上滚，1秒10次

00 34 00 0e 03 09 00 64 00 00

